(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5326],{85130:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var n=t(97131),o=t(14586);function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{wait:0},t=null,i=null,a=null,c=null;if(r.wait<0)throw new Error("wait must be 0 or more");if(r.maxWait){if(r.maxWait<0)throw new Error("maxWait must be 0 or more");if(r.maxWait<r.wait)throw new Error("maxWait must be higher than wait")}function s(){if(!r.maxWait)return r.wait;if(!a)throw new Error("Expected scheduledAt to be a set when getting wait");var e=Date.now()-a;return Math.min(r.maxWait-e,r.wait)}function u(){i&&clearTimeout(i),i=null,c=null,t=null,a=null}function l(){if(!t||!i)throw new Error("Expected to call debounced function once before flushing");var r=t,o=c;return u(),e.apply(void 0,(0,n.Z)(o)).then((function(e){return r.resolve(e),e})).catch((function(e){throw r.reject(e),e}))}function f(){if(!i||!t)throw new Error("Expected to call debounced function once before cancelling");var e=t;u(),e.reject(new Error("Debounced function cancelled"))}return Object.assign((function(){if(t){if(!i)throw new Error("Did not expect to have deferred and no timeout");clearTimeout(i)}else t=(0,o.Z)(),a=Date.now();for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return c=r,i=window.setTimeout((function(){l()}),s()),t.promise}),{isScheduled:function(){return Boolean(t&&i)},cancel:f,flush:l})}},14586:function(e,r,t){"use strict";function n(){var e,r,t={promise:new Promise((function(t,n){e=t,r=n})),resolve:function(r){t.isFulfilled=!0,e(r)},reject:function(e){t.isFulfilled=!0,r(e)},isFulfilled:!1};return t}t.d(r,{Z:function(){return n}})},81529:function(e,r,t){"use strict";t.d(r,{Q:function(){return n},o:function(){return o}});var n=".",o=".lesson"},98811:function(e,r,t){"use strict";t.d(r,{Z:function(){return ue}});var n=t(92809),o=t(30266),i=t(97131),a=t(809),c=t.n(a),s=t(24243),u=t(56023),l=t(84647),f=t(74298),p=t(81529),d=t(50055),h=t(68216),v=t(25997),m=t(14695),b=t(91077),y=t(30268),g=t(92953),w=t(17187),k=t(34606),x=t(21145),C=t(91296),E=t.n(C),O=t(62660),S=t(51595),Z=t(38934),T=t(25400),D=t(79056);function F(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return R(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return R(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}function R(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var j={replsList:function(){return"dataLossRepls"},replFiles:function(e){return"dataLossReplFiles".concat(e)},latestOp:function(e,r){return"dataLossLatestOp--".concat(e,"--").concat(r)},latestFlushedOp:function(e,r){return"dataLossLatestFlushed--".concat(e,"--").concat(r)},latestOwnOp:function(e,r){return"dataLosslatestOwnOp--".concat(e,"--").concat(r)}};function I(e,r){for(var t={latestOp:null,latestFlushedOp:null,latestOwnOp:null},n=0,o=Object.keys(t);n<o.length;n++){var i=o[n],a=localStorage.getItem(j[i](e,r));if(a){var c=void 0;try{c=JSON.parse(a)}catch(s){continue}c&&"object"===typeof c&&"number"===typeof c.crc32&&"number"===typeof c.version&&(t[i]=c)}}return t}function P(){var e=localStorage.getItem(j.replsList()),r=[];if(e){try{r=JSON.parse(e)}catch(t){localStorage.setItem(j.replsList(),"[]")}Array.isArray(r)||(r=[],localStorage.setItem(j.replsList(),"[]"))}return r}function N(e){var r=localStorage.getItem(j.replFiles(e)),t=[];if(r){try{t=JSON.parse(r)}catch(n){localStorage.setItem(j.replFiles(e),"[]")}Array.isArray(t)||(t=[],localStorage.setItem(j.replFiles(e),"[]"))}return t}function _(e){var r,t=F(N(e));try{for(t.s();!(r=t.n()).done;){var n=r.value;"string"===typeof n&&A(e,n)}}catch(i){t.e(i)}finally{t.f()}localStorage.removeItem(j.replFiles(e));var o=P().filter((function(r){return r!==e}));localStorage.setItem(j.replsList(),JSON.stringify(o))}function A(e,r){localStorage.removeItem(j.latestOp(e,r)),localStorage.removeItem(j.latestFlushedOp(e,r)),localStorage.removeItem(j.latestOwnOp(e,r));var t=N(e).filter((function(e){return e!==r}));localStorage.setItem(j.replFiles(e),JSON.stringify(t))}function L(e){var r=e.replId,t=e.filePath;!function(e){var r=P();r.includes(e)||(r.length>20?(_(r[0]),r[0]=e):r.push(e),localStorage.setItem(j.replsList(),JSON.stringify(r)))}(r);var n=N(r);n.includes(t)||(n.length>20?(_(n[0]),n[0]=t):n.push(t),localStorage.setItem(j.replFiles(r),JSON.stringify(n)))}function U(e){var r=e.filePath,t=e.replId,n=e.opType,o=e.op;localStorage.setItem(j[n](t,r),JSON.stringify(o))}var M={};function B(e){return z.apply(this,arguments)}function z(){return(z=(0,o.Z)(c().mark((function e(r){var t,n,i,a,s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.filePath,n=r.replId,i=r.serverVersion,a=r.serverContent,s=r.fetchOps,!M[t+n]){e.next=3;break}return e.abrupt("return");case 3:M[t+n]=!0,u=I(n,t),l=k.str(a)>>>0,Object.keys(u).forEach(function(){var e=(0,o.Z)(c().mark((function e(r){var t,n,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u[r]){e.next=3;break}return e.abrupt("return");case 3:if(!(i<t.version)){e.next=6;break}return S.kg.info("ot client dataloss",{opType:r,case:"server_forgot"}),e.abrupt("return");case 6:if(i!==t.version){e.next=9;break}return l!==t.crc32&&S.kg.info("ot client dataloss",{opType:r,case:"crc32_mistmach"}),e.abrupt("return");case 9:return e.prev=9,e.next=12,s(t.version,t.version);case 12:o=e.sent,a=(0,D.Z)(o,1),n=a[0],e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(9),S.kg.info("ot client dataloss",{opType:r,case:"error_fetching_op"}),e.abrupt("return");case 21:if(n){e.next=24;break}return S.kg.info("ot client dataloss",{opType:r,case:"op_not_found"}),e.abrupt("return");case 24:n.crc32!==t.crc32&&S.kg.info("ot client dataloss",{opType:r,case:"crc32_mismatch"});case 25:case"end":return e.stop()}}),e,null,[[9,17]])})));return function(r){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function q(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?V(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function W(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return G(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){throw e})),f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){function r(r){return e.apply(this,arguments)}return r.toString=function(){return e.toString()},r}((function(e){c=!0,i=e})),f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}function G(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function J(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,g.Z)(e);if(r){var o=(0,g.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,y.Z)(this,t)}}function Y(e){return e.map((function(e){if("delete"in e&&e.delete)return{d:e.delete};if("skip"in e&&e.skip)return e.skip;if("insert"in e&&"string"===typeof e.insert)return e.insert;throw new Error("Unexpected op type")}))}var H=function(e){(0,b.Z)(t,e);var r=J(t);function t(e,i){var a;return(0,h.Z)(this,t),a=r.call(this),(0,n.Z)((0,m.Z)(a),"linkedFile",void 0),(0,n.Z)((0,m.Z)(a),"channel",void 0),(0,n.Z)((0,m.Z)(a),"destroy",void 0),(0,n.Z)((0,m.Z)(a),"pending",void 0),(0,n.Z)((0,m.Z)(a),"inflight",void 0),(0,n.Z)((0,m.Z)(a),"inflightOpsPromise",void 0),(0,n.Z)((0,m.Z)(a),"version",void 0),(0,n.Z)((0,m.Z)(a),"serverContent",void 0),(0,n.Z)((0,m.Z)(a),"localContent",void 0),(0,n.Z)((0,m.Z)(a),"pendingCursors",void 0),(0,n.Z)((0,m.Z)(a),"flushedCursorIds",void 0),(0,n.Z)((0,m.Z)(a),"user",void 0),(0,n.Z)((0,m.Z)(a),"debounceSend",void 0),(0,n.Z)((0,m.Z)(a),"debounceCommit",void 0),(0,n.Z)((0,m.Z)(a),"commitPromise",void 0),(0,n.Z)((0,m.Z)(a),"isReconnecting",void 0),(0,n.Z)((0,m.Z)(a),"shouldTrackReconnects",void 0),(0,n.Z)((0,m.Z)(a),"shouldTrackDataLoss",void 0),(0,n.Z)((0,m.Z)(a),"replId",void 0),(0,n.Z)((0,m.Z)(a),"uncommittedOps",void 0),(0,n.Z)((0,m.Z)(a),"hasUncommittedMultiplayerOps",void 0),(0,n.Z)((0,m.Z)(a),"committedVersion",void 0),(0,n.Z)((0,m.Z)(a),"committedContent",void 0),(0,n.Z)((0,m.Z)(a),"bufferedReconnectingOps",void 0),(0,n.Z)((0,m.Z)(a),"didEditOffline",void 0),(0,n.Z)((0,m.Z)(a),"reconnectTrackedData",void 0),(0,n.Z)((0,m.Z)(a),"timeDisconnected",void 0),(0,n.Z)((0,m.Z)(a),"writeOps",(function(e){if(!a.channel&&!a.isReconnecting)throw new Error("Trying to send changes before ever coming online");a.isReconnecting&&(a.didEditOffline=!0);var r,t=a.localContent,n=[],o=0,i=W(e);try{for(i.s();!(r=i.n()).done;){var c=r.value,s=null;switch(typeof c){case"number":o+=c;break;case"string":var u=(0,O.strPosToUni)(t,o);s=u>0?[u,c]:[c],o+=c.length;break;case"object":var l=(0,O.strPosToUni)(t,o),f=(0,O.strPosToUni)(t,o+c.d)-l;s=l>0?[l,{d:f}]:[{d:f}];break;default:return void a.emit("error",new Error("OT Error: unknown op type"))}s&&(t=x.type.apply(t,s),n=x.type.compose(n,s))}}catch(p){i.e(p)}finally{i.f()}a.pending=x.type.compose(a.pending,n),a.localContent=t,0!==a.pending.length?a.emit("fileDirty"):a.commitPromise&&a.emit("commitStart"),a.debounceSend()})),(0,n.Z)((0,m.Z)(a),"updateCursors",(function(e){a.pendingCursors=e,a.debounceSend()})),(0,n.Z)((0,m.Z)(a),"isClean",(function(){return a.committedVersion===a.version&&0===a.inflight.length&&0===a.pending.length})),(0,n.Z)((0,m.Z)(a),"sendOps",(function(){if(a.channel&&"open"===a.channel.status&&!a.isReconnecting&&!(a.inflight.length>0)){if(0!==a.pending.length){var e=a.pending.map((function(e){return"object"===typeof e?{delete:e.d}:"number"===typeof e?{skip:e}:{insert:e}}));a.inflight=a.pending,a.pending=[],a.inflightOpsPromise=a.channel.request({ot:{spookyVersion:a.version,ops:e}}),a.inflightOpsPromise.then((function(r){r.error&&a.emit("error",new Error("OT Error: error accepting packet"),{originalError:r.error,ops:e})}))}if(0!==a.pendingCursors.length){var r,t=W(a.flushedCursorIds);try{for(t.s();!(r=t.n()).done;){var n=r.value;a.channel.send({otDeleteCursor:{id:n}})}}catch(u){t.e(u)}finally{t.f()}a.flushedCursorIds=[];var o,i=W(a.pendingCursors);try{for(i.s();!(o=i.n()).done;){var c=o.value,s=Number(Math.random().toString().split(".")[1]).toString(36);a.flushedCursorIds.push(s),a.channel.send({otNewCursor:q({id:s,user:a.user},c)})}}catch(u){i.e(u)}finally{i.f()}a.pendingCursors=[]}}})),(0,n.Z)((0,m.Z)(a),"handlePacket",(function(e,r){var t=e.ops,n=e.version,o=e.crc32,i=r.overrideReconnectringBuffer;if(!a.isReconnecting||i)if(-1!==a.version){if(a.version++,n!==a.version){var c={expectedVersion:a.version,receievedVersion:n,incomingOps:t};return S.kg.error("OT Error: invalid server version",(0,S.P1)({details:c})),void a.emit("error",new Error("OT Error: invalid server version"),c)}var s="";try{s=x.type.apply(a.serverContent,t)}catch(C){return void a.emit("error",new Error("OT Error: unable to apply updated content"),{originalError:C,incomingOps:t})}var u=k.str(s)>>>0;if(u!==o){var l={version:n,server:o,client:u,incomingOps:t};return S.kg.error("OT Error: crc32 mismatch",(0,S.P1)({details:l})),void a.emit("error",new Error("OT Error: crc32 mismatch"),l)}if(a.uncommittedOps.push({version:n,crc32:o,ops:t}),a.shouldTrackDataLoss&&U({replId:a.replId,filePath:a.linkedFile,opType:"latestOp",op:{version:n,crc32:o}}),JSON.stringify(t)===JSON.stringify(a.inflight))return a.shouldTrackDataLoss&&U({replId:a.replId,filePath:a.linkedFile,opType:"latestOwnOp",op:{version:n,crc32:o}}),a.debounceCommit(),a.inflight=[],a.inflightOpsPromise=null,a.serverContent=s,a.debounceSend(),void a.debounceSend.flush();if(a.commitPromise||a.emit("fileDirty"),a.debounceCommit(),a.hasUncommittedMultiplayerOps=!0,a.inflight.length){var f=x.type.transform(a.inflight,t,"right");t=x.type.transform(t,a.inflight,"left"),a.inflight=f}if(a.pending.length){var p=x.type.transform(a.pending,t,"right");t=x.type.transform(t,a.pending,"left"),a.pending=p}a.localContent=x.type.apply(a.localContent,t);var d,h=[],v=0,m=W(t);try{for(m.s();!(d=m.n()).done;){var b=d.value;switch(typeof b){case"number":v+=b;break;case"string":var y=(0,O.uniToStrPos)(a.localContent,v);h=y>0?T.qC(h,[y,b]):T.qC(h,[b]),v+=(0,O.strPosToUni)(b);break;case"object":var g=(0,O.uniToStrPos)(a.localContent,v),w=(0,O.uniToStrPos)(a.localContent,v+b.d)-g;h=g>0?T.qC(h,[g,{d:w}]):T.qC(h,[{d:w}]);break;default:return void a.emit("error",new Error("OT Error: unknown op type"))}}}catch(E){m.e(E)}finally{m.f()}a.serverContent=s,a.emit("op",h)}else a.emit("error",new Error("Got packet while version is still -1, expected version to be set in handleStatus"));else a.bufferedReconnectingOps.push({crc32:o,ops:t,version:n})})),(0,n.Z)((0,m.Z)(a),"handleNewCursor",(function(e){a.emit("cursor",e)})),(0,n.Z)((0,m.Z)(a),"handleDeleteCursor",(function(e){var r=e.id;a.emit("removeCursor",r)})),(0,n.Z)((0,m.Z)(a),"handleStatus",function(){var e=(0,o.Z)(c().mark((function e(r){var t,n,o,i,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.channel&&"open"===a.channel.status){e.next=2;break}return e.abrupt("return");case 2:if(!r.linkedFile){e.next=25;break}if(null!=r.contents){e.next=6;break}return a.emit("error",new Error("expected status contents,  got null or undefined")),e.abrupt("return");case 6:if(null!=r.cursors){e.next=9;break}return a.emit("error",new Error("expected status cursors, got null or undefined")),e.abrupt("return");case 9:if(null!=r.version){e.next=12;break}return a.emit("error",new Error("expected status version, got null or undefined")),e.abrupt("return");case 12:if(!a.isReconnecting){e.next=15;break}return a.handleReconnect(r.contents,r.version),e.abrupt("return");case 15:return a.shouldTrackDataLoss&&B({serverContent:r.contents,serverVersion:r.version,replId:a.replId,filePath:a.linkedFile,fetchOps:a.fetchOps}),a.serverContent=r.contents,a.localContent=a.serverContent,a.version=r.version,a.emit("firstConnect"),a.emit("op",[a.serverContent]),r.cursors.forEach(a.handleNewCursor),a.emit("fileDirty"),a.debounceCommit(),e.abrupt("return");case 25:return e.next=27,a.channel.request({otLinkFile:{file:{path:a.linkedFile},highConsistency:Boolean(window["flag-ot-high-consitency"])}});case 27:if(!(o=e.sent).channelClosed){e.next=30;break}return e.abrupt("return");case 30:if(!o.error){e.next=33;break}return a.emit("error",new Error("link file error "+o.error)),e.abrupt("return");case 33:if(o.otLinkFileResponse){e.next=36;break}return a.emit("error",new Error("link file error "+JSON.stringify(o.toJSON()))),e.abrupt("return");case 36:if(i=o.otLinkFileResponse.version,u=s.Z.from(null!==(t=null===(n=o.otLinkFileResponse.linkedFile)||void 0===n?void 0:n.content)&&void 0!==t?t:"").toString(),l=[u],!a.isReconnecting){e.next=42;break}return a.handleReconnect(u,i),e.abrupt("return");case 42:a.shouldTrackDataLoss&&B({serverContent:u,serverVersion:i,replId:a.replId,filePath:a.linkedFile,fetchOps:a.fetchOps}),a.serverContent=u,a.localContent=a.serverContent,a.version=i,a.committedVersion=i,a.committedContent=a.serverContent,a.emit("firstConnect"),a.emit("op",l);case 50:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(a),"handleReconnect",function(){var e=(0,o.Z)(c().mark((function e(r,t){var n,o,i,s,u,l,f,p,d,h,v,m,b,y,g,w,k,C,E,O,S,T,D,F,R,j,I,P,N,_,A;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.timeDisconnected){e.next=2;break}throw new Error("wat");case 2:if(n=Date.now()-a.timeDisconnected,o=function(e){a.reconnectTrackedData=q(q({},e),{},{serverVersion:t,ourVersion:a.version,ourCommittedVersion:a.committedVersion,areContentsEqual:a.serverContent===r,areCommittedContentsEqual:a.committedContent===r,didReceiveOpsWhileReconnecting:Boolean(a.bufferedReconnectingOps),didEditOffline:a.didEditOffline,hasPendingOps:Boolean(a.pending.length),disconnectDuration:n}),a.shouldTrackReconnects&&(0,Z.track)(Z.events.FILE_RECONNECTED_STATUS2,a.reconnectTrackedData)},i=function(){a.isReconnecting=!1,a.bufferedReconnectingOps=[],a.didEditOffline=!1,a.timeDisconnected=null,a.debounceSend(),a.debounceCommit(),a.emit("reconnected")},!a.inflight.length){e.next=23;break}if(t!==a.version||a.serverContent!==r){e.next=13;break}return o({case:"has_inflight_happy_path_ops_unreached",prompted:!1}),a.pending=x.type.compose(a.inflight,a.pending),a.inflight=[],a.inflightOpsPromise=null,i(),e.abrupt("return");case 13:s=!1,u=a.serverContent;try{u=x.type.apply(r,a.inflight)}catch(c){s=!0}if(s||a.version+1!==t||u!==r){e.next=20;break}return o({case:"has_inflight_happy_path_ops_reached",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 20:return o({case:"has_inflight",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 23:if(!a.hasUncommittedMultiplayerOps){e.next=27;break}return o({case:"multiplayer",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 27:if(a.version!==t){e.next=35;break}if(r!==a.serverContent){e.next=32;break}return o({case:"happy_path",prompted:!1}),i(),e.abrupt("return");case 32:return o({case:"same_version_different_content",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 35:if(a.committedVersion!==t){e.next=61;break}l=r,e.prev=37,f=W(a.uncommittedOps);try{for(f.s();!(p=f.n()).done;)d=p.value.ops,l=x.type.apply(l,d)}catch(L){f.e(L)}finally{f.f()}e.next=47;break;case 42:return e.prev=42,e.t0=e.catch(37),o({case:"same_committed_version_unable_to_apply_ops",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 47:if(l!==a.serverContent){e.next=58;break}o({case:"happy_path_uncommitted",prompted:!1}),h=[],v=W(a.uncommittedOps);try{for(v.s();!(m=v.n()).done;)b=m.value.ops,h=x.type.compose(h,b)}catch(L){v.e(L)}finally{v.f()}return a.pending=x.type.compose(h,a.pending),a.uncommittedOps=[],a.version=t,a.serverContent=r,i(),e.abrupt("return");case 58:return o({case:"same_committed_version_different_content_fixed",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 61:if(!(a.version<t)){e.next=85;break}return e.next=64,a.fetchOps(a.version+1,t);case 64:y=e.sent,g=!1,w=a.serverContent;try{k=W(y);try{for(k.s();!(C=k.n()).done;)E=C.value.ops,w=x.type.apply(w,E)}catch(L){k.e(L)}finally{k.f()}}catch(c){g=!0}if(g||w!==r){e.next=76;break}o({case:"happy_path_server_ahead",prompted:!1}),O=W(y);try{for(O.s();!(S=O.n()).done;)T=S.value,a.handlePacket(T,{overrideReconnectringBuffer:!0})}catch(L){O.e(L)}finally{O.f()}D=W(a.bufferedReconnectingOps);try{for(D.s();!(F=D.n()).done;)R=F.value,a.handlePacket(R,{overrideReconnectringBuffer:!0})}catch(L){D.e(L)}finally{D.f()}return i(),e.abrupt("return");case 76:return e.next=78,a.fetchOps(a.committedVersion+1,t);case 78:j=e.sent,I=!1,P=a.committedContent;try{N=W(j);try{for(N.s();!(_=N.n()).done;)A=_.value.ops,P=x.type.apply(P,A)}catch(L){N.e(L)}finally{N.f()}}catch(c){I=!0}return I||P!==r||o({case:"happy_path_uncommitted_server_ahead",prompted:!0}),a.emit("promptUserReconnect"),e.abrupt("return");case 85:o({case:"other",prompted:!0}),a.emit("promptUserReconnect");case 87:case"end":return e.stop()}}),e,null,[[37,42]])})));return function(r,t){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(a),"flush",(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.commitPromise;case 2:return a.debounceCommit(),a.debounceCommit.flush(),e.next=6,a.commitPromise;case 6:case"end":return e.stop()}}),e)})))),(0,n.Z)((0,m.Z)(a),"fetchOps",function(){var e=(0,o.Z)(c().mark((function e(r,t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.channel){e.next=2;break}throw new Error("No cahnnel, cannot fetch");case 2:return e.next=4,a.channel.request({otFetchRequest:{versionFrom:r,versionTo:t}});case 4:if(!(n=e.sent).channelClosed){e.next=7;break}throw new Error("Channel closed while requesting");case 7:if(!n.error){e.next=9;break}throw new Error("Fetch ops returned an error"+n.error);case 9:if(n.otFetchResponse){e.next=11;break}throw new Error("Expected otFetchResponse");case 11:if(n.otFetchResponse.packets){e.next=13;break}throw new Error("Expected otFetchResponse.packets");case 13:return e.abrupt("return",n.otFetchResponse.packets.map((function(e){var r=e.crc32,t=e.ops,n=e.version;if(null==r)throw new Error("Expected crc32 in packet");if(null==t)throw new Error("Expected ops in packet");if(null==n)throw new Error("Expected version in packet");return{crc32:r,version:n,ops:Y(t)}})));case 14:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),(0,n.Z)((0,m.Z)(a),"transformSelection",function(){var e=(0,o.Z)(c().mark((function e(r){var t,n,o,i,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.indexStart,n=r.indexEnd,o=r.versionFrom,i=r.versionTo,a.channel){e.next=3;break}throw new Error("No channel, cannot fetch");case 3:return e.next=5,a.channel.request({otTransformSelectionRequest:{indexStart:t,indexEnd:n,versionFrom:o,versionTo:i}});case 5:if((s=e.sent).otTransformSelectionResponse){e.next=8;break}throw new Error("Expected otTransformSelectionResponse");case 8:return e.abrupt("return",s.otTransformSelectionResponse);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),a.shouldTrackDataLoss=!1,a.replId="",a.linkedFile=e,a.channel=null,a.inflight=[],a.inflightOpsPromise=null,a.uncommittedOps=[],a.hasUncommittedMultiplayerOps=!1,a.committedVersion=-1,a.isReconnecting=!1,a.bufferedReconnectingOps=[],a.didEditOffline=!1,a.pending=[],a.version=-1,a.serverContent="",a.localContent="",a.committedContent="",a.flushedCursorIds=[],a.pendingCursors=[],a.user=null,a.debounceSend=E()((function(){return a.sendOps()}),20,{maxWait:60}),a.debounceCommit=E()((function(){return a.commitToDisk()}),1e3,{maxWait:3e3}),a.commitPromise=null,a.timeDisconnected=null,a.shouldTrackReconnects=!1,a.destroy=i.openChannel({service:"ot",name:"ot:".concat(e)},(function(r){if(!r.error){var t=r.channel,n=r.context;return a.user=n.currentUser?{name:n.currentUser.username,id:n.currentUser.id}:null,n.currentUser&&n.repl&&(a.shouldTrackDataLoss=n.currentUser.flagTrackOtClientDataLoss,a.replId=n.repl.id,a.shouldTrackDataLoss&&L({replId:a.replId,filePath:e})),a.channel=t,t.onCommand((function(e){switch(e.body){case"ot":if(!e.ot||null==e.ot.ops||null==e.ot.spookyVersion||null==e.ot.crc32)return void a.emit("error",new Error("OT Error: missing data in ot packet"),e.ot||{});if(-1===a.version)return;var r={crc32:e.ot.crc32,ops:Y(e.ot.ops),version:e.ot.spookyVersion};return a.handlePacket(r,{overrideReconnectringBuffer:!1});case"otstatus":return a.handleStatus(e.otstatus);case"error":if(e.ref)return;return a.emit("error",new Error("Unkown protocol error OT channel"),{originalError:e.error||"Server error"});case"otNewCursor":return a.handleNewCursor(e.otNewCursor);case"otDeleteCursor":return a.handleDeleteCursor(e.otDeleteCursor)}})),function(){a.channel=null,a.isReconnecting=!0,a.debounceSend.cancel(),a.debounceCommit.cancel(),a.timeDisconnected||(a.timeDisconnected=Date.now())}}})),a}return(0,v.Z)(t,[{key:"commitToDisk",value:function(){var e=(0,o.Z)(c().mark((function e(){var r,t,n,o,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.channel){e.next=2;break}throw new Error("Tryna commit while offline");case 2:if("open"===this.channel.status){e.next=4;break}return e.abrupt("return");case 4:if(!this.isReconnecting){e.next=6;break}throw new Error("Committing while reconnecting");case 6:if(!this.isClean()){e.next=8;break}return e.abrupt("return");case 8:if(!this.commitPromise){e.next=11;break}return this.debounceCommit(),e.abrupt("return");case 11:if(r=function(){},this.commitPromise=new Promise((function(e){return r=e})),!this.inflightOpsPromise){e.next=21;break}return e.next=16,this.inflightOpsPromise;case 16:if(!e.sent.channelClosed){e.next=21;break}return this.commitPromise=null,r(),e.abrupt("return");case 21:if(!(this.pending.length>0)){e.next=36;break}if(this.debounceSend(),this.debounceSend.flush(),this.inflightOpsPromise){e.next=29;break}return this.commitPromise=null,r(),this.emit("error",new Error("expected inflight promise")),e.abrupt("return");case 29:return e.next=31,this.inflightOpsPromise;case 31:if(!e.sent.channelClosed){e.next=36;break}return this.commitPromise=null,r(),e.abrupt("return");case 36:return this.emit("commitStart"),t=this.version,n=this.serverContent,e.next=41,this.channel.request({flush:{}});case 41:if(!(o=e.sent).channelClosed){e.next=46;break}return this.commitPromise=null,r(),e.abrupt("return");case 46:if("ok"===o.body){e.next=51;break}return this.commitPromise=null,r(),this.emit("error",new Error("OT Error: unable to flush"),{originalError:o.error||o.toString()}),e.abrupt("return");case 51:return this.shouldTrackDataLoss&&(i=this.uncommittedOps[this.uncommittedOps.length-1])&&U({replId:this.replId,filePath:this.linkedFile,op:{crc32:i.crc32,version:i.version},opType:"latestFlushedOp"}),this.uncommittedOps=[],this.hasUncommittedMultiplayerOps=!1,this.committedVersion=t,this.committedContent=n,this.emit("commitComplete",t),this.isClean()&&this.emit("fileClean"),this.commitPromise=null,r(),e.abrupt("return",o);case 61:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),t}(w.EventEmitter),$=t(19989),K=t(7977),X=t.n(K),Q=t(71371),ee=t(85130),re=t(14586);function te(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function ne(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?te(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):te(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function oe(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return ie(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ie(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}function ie(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ae(e){return!!e.includes("no such file")||!!e.includes("file does not exist")}function ce(e){return ae(e)?u.Df.NotFound:e.includes("file exist")?u.Df.AlreadyExists:e.includes("not a directory")?u.Df.NotDirectory:void 0}function se(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return new Promise((function(r,n){setTimeout((function(){e.apply(void 0,t).then(r).catch(n)}),0)}))}function ue(e){var r,t=e.container,n=null,a=null,h=null,v=0,m={},b={},y={};t.openChannel({service:"fsevents"},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");n=t,t.onCommand((function(e){if("fileEvent"===e.body){if(!e.fileEvent)throw new Error("Expected fileEvent");var r=e.fileEvent,t=r.file,n=r.dest,o=r.op;if(t){var i=t.path;if(null!==i&&null!==o&&void 0!==i&&void 0!==o){var a;if(S(),m[i]||t.type===d.api.File.Type.DIRECTORY)a=u.Tv.Directory;else{var c=Object.keys(m).find((function(e){return(0,f.pC)(e,i)})),s=c&&m[c].children.find((function(e){return e.filename===(0,l.UO)(i)}));a=s?s.type:u.Tv.File}switch(o){case d.api.FileEvent.Op.Create:_({eventType:u.kS.Create,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Modify:if(a===u.Tv.Directory)break;_({eventType:u.kS.Modify,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Remove:_({eventType:u.kS.Delete,node:{path:i,type:a}});break;case d.api.FileEvent.Op.Move:if(null==n||null==n.path)throw new Error("Expected dest path");var p=n.path;_({eventType:u.kS.Move,node:{path:i,type:a},to:p})}}}}}));var o=(0,i.Z)(new Set([].concat((0,i.Z)(Object.keys(m)),(0,i.Z)(Object.keys(b)),(0,i.Z)(Object.keys(y)))));return o.length&&t.send({subscribeFile:{files:o.map((function(e){return{path:e}}))}}),function(){n=null}}}));var g=new Promise((function(e){return r=e}));t.openChannel({service:function(e){return e.repl.currentUserPermissions.containerWrite?"gcsfiles":"files"}},(function(e){var t=e.error,n=e.channel;if(!t){if(!n)throw new Error("Expected channel");return r(n),function(){g=new Promise((function(e){return r=e}))}}}));var w=(0,re.Z)();w.promise.catch((function(e){return e}));var x=(0,ee.Z)((0,o.Z)(c().mark((function e(){var r,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.promise;case 2:return r=e.sent,e.next=5,r.request({fsSnapshot:{}});case 5:if(!(t=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",{success:!1,error:"channel closed"});case 8:if(!t.error){e.next=10;break}return e.abrupt("return",{success:!1,error:t.error});case 10:return e.abrupt("return",{success:!0});case 11:case"end":return e.stop()}}),e)}))),{wait:5e3,maxWait:1e4});t.openChannel({service:"snapshot",skip:function(e){return!e.repl.currentUserPermissions.containerWrite}},(function(e){var r=e.error,t=e.channel;if(!r){if(!t)throw new Error("Expected channel");return w.resolve(t),function(){w.isFulfilled&&(w=(0,re.Z)()).promise.catch((function(e){return e}))}}w.isFulfilled||w.reject(r)}));var C=u.kO.Clean,E=[],O=0;function S(){return D.apply(this,arguments)}function D(){return(D=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O++,F(),e.next=4,B.persist();case 4:O--,F();case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return R.apply(this,arguments)}function R(){return(R=(0,o.Z)(c().mark((function e(){var r,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0===O&&0===j.length&&Object.values(b).every((function(e){return e.otClient.isClean()})),t=C===u.kO.Clean,r!==t){e.next=4;break}return e.abrupt("return");case 4:C=r?u.kO.Clean:u.kO.Syncing,E.forEach((function(e){e(C)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=[];function I(e){j.push(e),F(),e.then((function(){var r=j.indexOf(e);r>-1&&j.splice(r,1),S()}))}function P(e,r){return N.apply(this,arguments)}function N(){return(N=(0,o.Z)(c().mark((function e(r,t){var n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n=function(){var e=(0,o.Z)(c().mark((function e(){var t,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g;case 2:return t=e.sent,e.next=5,t.request(r);case 5:if(!(o=e.sent).channelClosed){e.next=8;break}return e.abrupt("return",se(n));case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())(),t.isMutative&&I(i),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){h=null;var r=e.node.path.includes("/")?(0,l.Il)(e.node.path):p.Q,t=m[r],n=(0,l.UO)(e.node.path);if(!n)throw new Error("Expected filename");var o=null;if(e.eventType===u.kS.Move){var a=e.to.includes("/")?(0,l.Il)(e.to):p.Q;o=m[a]}if(t||o)switch(e.eventType){case u.kS.Create:var c,s=[].concat((0,i.Z)(t.children.filter((function(e){return e.filename!==n}))),[{type:e.node.type,filename:n}]),d=oe(t.listeners);try{for(d.s();!(c=d.n()).done;){(0,c.value.onChange)(s)}}catch(J){d.e(J)}finally{d.f()}t.children=s;break;case u.kS.Move:var v=(0,l.UO)(e.to);if(t===o){var g,w=[].concat((0,i.Z)(t.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),k=oe(t.listeners);try{for(k.s();!(g=k.n()).done;){(0,g.value.onChange)(w)}}catch(J){k.e(J)}finally{k.f()}t.children=w;break}if(t){var x,C=t.children.filter((function(e){return e.filename!==n})),E=oe(t.listeners);try{for(E.s();!(x=E.n()).done;){(0,x.value.onChange)(C)}}catch(J){E.e(J)}finally{E.f()}t.children=C}if(o){var O,S=[].concat((0,i.Z)(o.children.filter((function(e){return e.filename!==n&&e.filename!==v}))),[{type:e.node.type,filename:v}]),Z=oe(o.listeners);try{for(Z.s();!(O=Z.n()).done;){(0,O.value.onChange)(S)}}catch(J){Z.e(J)}finally{Z.f()}o.children=S}break;case u.kS.Delete:var T,D=t.children.filter((function(e){return e.filename!==n})),F=oe(t.listeners);try{for(F.s();!(T=F.n()).done;){(0,T.value.onChange)(D)}}catch(J){F.e(J)}finally{F.f()}t.children=D;break;case u.kS.Modify:break;default:throw new Error("unknown event")}switch(e.eventType){case u.kS.Move:case u.kS.Delete:for(var R=0,j=[b[e.node.path],y[e.node.path],m[e.node.path]];R<j.length;R++){var I=j[R];if(I){var P,N=oe(I.listeners);try{for(N.s();!(P=N.n()).done;){var A=P.value,L=A.onMoveOrDelete,U=A.dispose;L&&L(e),U()}}catch(J){N.e(J)}finally{N.f()}}}if(e.node.type===u.Tv.File)break;var M,z=[],V=oe(Object.values(ne(ne(ne({},m),y),b)).sort());try{for(V.s();!(M=V.n()).done;){var q=M.value;if((0,f.yr)(e.node.path,q.path)){var W=z.slice(-1)[0];if(!W||!(0,f.yr)(W,q.path)){var G={eventType:u.kS.Delete,node:{path:q.path,type:q.type}};e.eventType===u.kS.Move&&(G=ne(ne({},G),{},{eventType:u.kS.Move,to:(0,f.hk)(e.node.path,e.to,q.path)})),z.push(q.path),_(G)}}}}catch(J){V.e(J)}finally{V.f()}break;case u.kS.Create:case u.kS.Modify:if(!y[e.node.path])break;B.readFile(e.node.path).then((function(r){var t=y[e.node.path];if(t)if(r.error)_({eventType:u.kS.Delete,node:{path:e.node.path,type:u.Tv.File}});else{var n,o=oe(t.listeners);try{for(o.s();!(n=o.n()).done;){var i=n.value.onChange;i&&i(r.content)}}catch(J){o.e(J)}finally{o.f()}}})).catch((function(e){e.message="File read after modify error: "+e.message,Q.Tb(e)}))}}function A(){return L.apply(this,arguments)}function L(){return(L=(0,o.Z)(c().mark((function e(){var r,n,o,a,s,u,l,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=window.performance.now(),e.next=3,t.exec.apply(t,["ag","--noaffinity","-g *","--hidden"].concat((0,i.Z)($.ignoredDirs.map((function(e){return"--ignore=".concat(e)})))));case 3:if(o=e.sent,a=o.output,s=o.error,(0,Z.track)(Z.events.LIST_FILES_EXECUTED,{duration:window.performance.now()-n,failed:Boolean(s)&&"exit status 1"!==s}),u=null===(r=t.getContext())||void 0===r?void 0:r.repl){e.next=10;break}throw new Error("Expected repl");case 10:if(l=function(e){return!!e&&(!(0,$.isHiddenFile)(e)&&!X().isLangFileBinary(u.language,e))},s||!a){e.next=14;break}return h={error:null,files:a.split("\n").filter(l)},e.abrupt("return",h);case 14:if(!s||!s.includes("not found")){e.next=22;break}return e.next=17,t.exec("find",".","-type","f","-print0");case 17:if(f=e.sent,(0,Z.track)(Z.events.AG_NOT_AVAILABLE,{language:u.language}),!f.output){e.next=22;break}return h={error:null,files:f.output.slice(2,-1).split("\0./").filter(l)},e.abrupt("return",h);case 22:return"exit status 1"!==s&&Q.Tb(new Error("Find file command failed with error: ".concat(s))),e.abrupt("return",{error:s,files:null});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=(0,o.Z)(c().mark((function e(r,t,n){var i,a,s,l,f,p,d,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=(0,o.Z)(c().mark((function e(r){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.request(r);case 2:if(!(t=e.sent).channelClosed){e.next=5;break}throw new Error("channelClosed");case 5:if(!t.error){e.next=7;break}throw new Error(t.error);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(e){return s.apply(this,arguments)},e.next=4,g;case 4:return i=e.sent,e.prev=5,e.next=8,a({transferStart:{path:r,size:t.length}});case 8:if(l=e.sent,f=l.transfer){e.next=12;break}throw new Error("Failed to start a transfer (no transfer id)");case 12:p=t.toBuffer(),d=512e3,n(p.length,0),h=0;case 16:if(!(h<Math.ceil(t.length/d))){e.next=23;break}return e.next=19,a({transferChunk:{id:f.id,content:p.subarray(h*d,(h+1)*d)}});case 19:n(p.length,Math.min(p.length,(h+1)*d));case 20:h++,e.next=16;break;case 23:return e.next=25,a({transferComplete:{id:f.id,crc32:k.buf(p)}});case 25:e.next=36;break;case 27:if(e.prev=27,e.t0=e.catch(5),"channelClosed"!==e.t0.message){e.next=31;break}return e.abrupt("return",se(B.transferFile,r,t,n));case 31:if(!e.t0.message.includes("not a directory")){e.next=33;break}return e.abrupt("return",{error:u.Df.NotDirectory});case 33:if(!e.t0.message.includes("file exists")){e.next=35;break}return e.abrupt("return",{error:u.Df.IsDirectory});case 35:throw e.t0;case 36:return _({eventType:u.kS.Create,node:{path:r,type:u.Tv.File}}),e.abrupt("return",{error:null});case 38:case"end":return e.stop()}}),e,null,[[5,27]])})));return function(r,t,n){return e.apply(this,arguments)}}();function M(e){if(e.startsWith("/home/runner"))throw new Error("watchOtFile requires relative paths");var r=new H(e,t);return r.on("commitComplete",S),r.on("fileDirty",F),r.on("fileClean",F),r.on("commitStart",F),r}var B={getStatus:function(){return C},onStatusChange:function(e){return E.push(e),function(){var r=E.indexOf(e);r>-1&&E.splice(r,1)}},watchDir:function(e,r){var t=!1,o=function r(){t=!0,m[e]&&(m[e].listeners=m[e].listeners.filter((function(e){return e.dispose!==r})),0===m[e].listeners.length&&delete m[e])};return B.readDir(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError(a),void o()}m[e]||(m[e]={path:e,type:u.Tv.Directory,children:i.children,listeners:[]},n&&n.send({subscribeFile:{files:[{path:e}]}})),m[e].listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.children)}})).catch((function(e){o(),r.onError(e)})),o},writeFile:function(e,r){return(0,o.Z)(c().mark((function t(){var n,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P({write:{path:e,content:r.toBuffer()}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=9;break}if(o=null,n.error.includes("not a directory")?o=u.Df.NotDirectory:n.error.includes("file exists")&&(o=u.Df.IsDirectory),o){t.next=8;break}throw new Error(n.error);case 8:return t.abrupt("return",{error:o});case 9:return y[e]||b[e]||m[(0,l.Il)(e)]&&m[(0,l.Il)(e)].children.some((function(r){return r.filename===(0,l.UO)(e)}))?_({eventType:u.kS.Modify,node:{path:e,type:u.Tv.File}}):_({eventType:u.kS.Create,node:{path:e,type:u.Tv.File}}),t.abrupt("return",{error:null});case 11:case"end":return t.stop()}}),t)})))()},transferFile:function(){var e=arguments;return(0,o.Z)(c().mark((function r(){var t;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return I(t=U.apply(void 0,(0,i.Z)(e))),r.abrupt("return",t);case 3:case"end":return r.stop()}}),r)})))()},readFile:function(e){return(0,o.Z)(c().mark((function r(){var t,n,o;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!b[e]){r.next=3;break}return t=b[e].otClient.localContent,r.abrupt("return",{content:s.Z.from(t),error:null});case 3:return r.next=5,P({read:{path:e}},{isMutative:!1});case 5:if(!(n=r.sent).error){r.next=12;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("is a directory")&&(o=u.Df.IsDirectory),o){r.next=11;break}throw new Error(n.error);case 11:return r.abrupt("return",{error:o});case 12:if(n.file&&n.file.path&&n.file.content){r.next=14;break}throw new Error("Expected file");case 14:return r.abrupt("return",{content:s.Z.from(n.file.content),error:null});case 15:case"end":return r.stop()}}),r)})))()},createDir:function(e){return(0,o.Z)(c().mark((function r(){var t,n;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P({mkdir:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,t.error.includes("not a directory")&&(n=u.Df.NotDirectory),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Create,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},moveDir:function(e,r){return(0,o.Z)(c().mark((function t(){var n,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=ce(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return _({eventType:u.kS.Move,node:{path:e,type:u.Tv.Directory},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},moveFile:function(e,r){return(0,o.Z)(c().mark((function t(){var n,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P({move:{oldPath:e,newPath:r}},{isMutative:!0});case 2:if(!(n=t.sent).error){t.next=8;break}if(o=ce(n.error)){t.next=7;break}throw new Error(n.error);case 7:return t.abrupt("return",{error:o});case 8:return _({eventType:u.kS.Move,node:{path:e,type:u.Tv.File},to:r}),t.abrupt("return",{error:null});case 10:case"end":return t.stop()}}),t)})))()},copyFile:function(e,r){return(0,o.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.readFile(e);case 2:if(!(n=t.sent).error){t.next=5;break}return t.abrupt("return",n);case 5:return t.abrupt("return",B.writeFile(r,n.content));case 6:case"end":return t.stop()}}),t)})))()},copyDirFromRemote:function(e,r,t){var n=this;return(0,o.Z)(c().mark((function o(){var i,a,s,l,f,p,d,h,v;return c().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.deleteDir(e);case 2:return o.next=4,t.readDir(e);case 4:if(!(i=o.sent).error){o.next=7;break}return o.abrupt("return",i);case 7:return o.next=9,n.readDir(r);case 9:if((a=o.sent).error!==u.Df.NotFound){o.next=15;break}return o.next=13,n.createDir(e);case 13:o.next=17;break;case 15:if(a.error!==u.Df.NotDirectory){o.next=17;break}return o.abrupt("return",a);case 17:s=oe(i.children),o.prev=18,s.s();case 20:if((l=s.n()).done){o.next=44;break}if(f=l.value,p="".concat(e,"/").concat(f.filename),f.type!==u.Tv.File){o.next=36;break}return o.next=26,t.readFile(p);case 26:if(!(d=o.sent).error){o.next=29;break}return o.abrupt("return",d);case 29:return o.next=31,n.writeFile("".concat(r,"/").concat(f.filename),d.content);case 31:if(!(h=o.sent).error){o.next=34;break}return o.abrupt("return",h);case 34:o.next=42;break;case 36:if(f.type!==u.Tv.Directory){o.next=42;break}return o.next=39,n.copyDirFromRemote(p,"".concat(r,"/").concat(f.filename),t);case 39:if(!(v=o.sent).error){o.next=42;break}return o.abrupt("return",v);case 42:o.next=20;break;case 44:o.next=49;break;case 46:o.prev=46,o.t0=o.catch(18),s.e(o.t0);case 49:return o.prev=49,s.f(),o.finish(49);case 52:return o.abrupt("return",{error:null});case 53:case"end":return o.stop()}}),o,null,[[18,46,49,52]])})))()},deleteFile:function(e){return(0,o.Z)(c().mark((function r(){var t,n;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Delete,node:{path:e,type:u.Tv.File}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},deleteDir:function(e){return(0,o.Z)(c().mark((function r(){var t,n;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P({remove:{path:e}},{isMutative:!0});case 2:if(!(t=r.sent).error){r.next=9;break}if(n=null,ae(t.error)&&(n=u.Df.NotFound),n){r.next=8;break}throw new Error(t.error);case 8:return r.abrupt("return",{error:n});case 9:return _({eventType:u.kS.Delete,node:{path:e,type:u.Tv.Directory}}),r.abrupt("return",{error:null});case 11:case"end":return r.stop()}}),r)})))()},readDir:function(e){return(0,o.Z)(c().mark((function r(){var t,n,o,i;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P({readdir:{path:e}},{isMutative:!1});case 2:if(!(n=r.sent).error){r.next=9;break}if(o=null,ae(n.error)?o=u.Df.NotFound:n.error.includes("not a directory")&&(o=u.Df.NotDirectory),o){r.next=8;break}throw new Error(n.error);case 8:return r.abrupt("return",{error:o});case 9:if(null!==(t=n.files)&&void 0!==t&&t.files){r.next=11;break}throw new Error("Expected filesChannel");case 11:return i=n.files.files.map((function(e){if(!e.path)throw new Error("Expected path");return{filename:e.path,type:e.type===d.api.File.Type.DIRECTORY?u.Tv.Directory:u.Tv.File}})),r.abrupt("return",{children:i,error:null});case 13:case"end":return r.stop()}}),r)})))()},stat:function(e){return(0,o.Z)(c().mark((function r(){var t;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P({stat:{path:e}},{isMutative:!1});case 2:if(!(t=r.sent).error){r.next=5;break}throw new Error(t.error);case 5:if(t.statRes){r.next=7;break}throw new Error("expected stat result");case 7:if(t.statRes.exists){r.next=9;break}return r.abrupt("return",{exists:!1});case 9:if(t.statRes.type!==d.api.File.Type.DIRECTORY){r.next=11;break}return r.abrupt("return",{exists:!0,type:u.Tv.Directory,lastModified:new Date(1e3*t.statRes.modTime)});case 11:return r.abrupt("return",{exists:!0,type:u.Tv.File,lastModified:new Date(1e3*t.statRes.modTime),byteLength:Number(t.statRes.size)});case 12:case"end":return r.stop()}}),r)})))()},watchOtFile:function(e,r,t){var n=this;b[e]||(b[e]={path:e,type:u.Tv.File,listeners:[],otClient:M(e)}),t&&(b[e].otClient.shouldTrackReconnects=!0);var i=!1,a=function(){},l=function l(p){a();var d=function(e){var t;return null===(t=r.onFlush)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("commitComplete",d);var h=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Dirty)};b[e].otClient.on("fileDirty",h);var v=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Clean)};b[e].otClient.on("fileClean",v);var m=function(){var e;return null===(e=r.onStatusChange)||void 0===e?void 0:e.call(r,u.KF.Syncing)};b[e].otClient.on("commitStart",m);var y=function(e){var t;return null===(t=r.onCursor)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("cursor",y);var g=function(e){var t;return null===(t=r.onRemoveCursor)||void 0===t?void 0:t.call(r,e)};b[e].otClient.on("removeCursor",g);var w=function(){var r=(0,o.Z)(c().mark((function r(o){var i,a,u,l,f,p,d;return c().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if((i=b[e].otClient).destroy(),a=function(){var r=M(e);return t&&(r.shouldTrackReconnects=!0),new Promise((function(t,n){r.once("op",(function(){var n=i.localContent,o=r.localContent,a=(0,T.sQ)(n,o);b[e].otClient=r;var c,s=oe(b[e].listeners);try{for(s.s();!(c=s.n()).done;){(0,c.value.reregister)(a)}}catch(l){s.e(l)}finally{s.f()}t()})),r.once("error",(function(e){return n(e)}))}))},"remote"!==o){r.next=7;break}return r.next=6,a();case 6:return r.abrupt("return");case 7:return r.next=9,n.writeFile(e,s.Z.from(i.localContent));case 9:if(!(u=r.sent).error){r.next=16;break}(l=new Error("Got error while overwriting file during reconnect")).code=u.error,f=oe(b[e].listeners);try{for(f.s();!(p=f.n()).done;)(d=p.value).onError&&d.onError(l),d.dispose()}catch(l){f.e(l)}finally{f.f()}return r.abrupt("return");case 16:return r.next=18,a();case 18:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),k=function(){var e;return null===(e=r.onReconnectFail)||void 0===e?void 0:e.call(r,w)};b[e].otClient.on("promptUserReconnect",k),b[e].listeners[0].reregister===l&&b[e].otClient.on("promptUserReconnect",(function(){b[e]&&(b[e].listeners.some((function(e){return e.onReconnectFail}))||w("remote"))}));var x=function(e,t){r.onError&&r.onError(e,t),f()};b[e].otClient.on("error",x);var C,E=function(t){b[e].otClient.writeOps(t);var n,o=oe(b[e].listeners);try{for(o.s();!(n=o.n()).done;){var i=n.value.onChange;i&&i!==r.onChange&&i({ops:t,changeSource:u.Fl.Local,version:b[e].otClient.version,latestContent:b[e].otClient.localContent})}}catch(a){o.e(a)}finally{o.f()}},O=function(r){b[e].otClient.updateCursors(r)};(-1!==b[e].otClient.version&&setTimeout((function(){var t;i||null===(t=r.onReady)||void 0===t||t.call(r,{initialContent:s.Z.from(b[e].otClient.localContent),writeOps:E,updateSelections:O,fetchOps:b[e].otClient.fetchOps,transformSelection:b[e].otClient.transformSelection,version:b[e].otClient.version})})),p)&&(null===(C=r.onChange)||void 0===C||C.call(r,{ops:p,changeSource:u.Fl.Container,version:b[e].otClient.version,latestContent:b[e].otClient.localContent}));var S=function(t){var n,o;if(!i)return i=!0,void(null===(o=r.onReady)||void 0===o||o.call(r,{initialContent:s.Z.from(b[e].otClient.localContent),writeOps:E,updateSelections:O,fetchOps:b[e].otClient.fetchOps,transformSelection:b[e].otClient.transformSelection,version:b[e].otClient.version}));null===(n=r.onChange)||void 0===n||n.call(r,{ops:t,changeSource:u.Fl.Container,version:b[e].otClient.version,latestContent:b[e].otClient.localContent})};b[e].otClient.on("op",S),a=function(){b[e].otClient.removeListener("commitComplete",d),b[e].otClient.removeListener("fileDirty",h),b[e].otClient.removeListener("fileClean",v),b[e].otClient.removeListener("commitStart",m),b[e].otClient.removeListener("error",x),b[e].otClient.removeListener("op",S),b[e].otClient.removeListener("cursor",y),b[e].otClient.removeListener("removeCursor",g),b[e].otClient.removeListener("promptUserReconnect",k)},F()},f=function r(){b[e]&&(i=!0,a(),b[e].listeners=b[e].listeners.filter((function(e){return e.dispose!==r})),0===b[e].listeners.length&&(b[e].otClient.destroy(),delete b[e]))};return b[e].listeners.push(ne(ne({},r),{},{dispose:f,reregister:l})),l(),f},watchFile:function(e,r){var t=!1,o=function r(){t=!0,y[e]&&(y[e].listeners=y[e].listeners.filter((function(e){return e.dispose!==r})),0===y[e].listeners.length&&delete y[e])};return B.readFile(e).then((function(i){if(!t){if(i.error){var a=new Error(i.error);return a.code=i.error,r.onError&&r.onError(a),void o()}y[e]||(y[e]={path:e,type:u.Tv.File,listeners:[]},n&&n.send({subscribeFile:{files:[{path:e}]}})),y[e].listeners.push(ne(ne({},r),{},{dispose:o})),r.onChange(i.content)}})),o},listFiles:function(){return(0,o.Z)(c().mark((function e(){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(h&&window.performance.now()-v<1e4)){e.next=2;break}return e.abrupt("return",h);case 2:return a||(a=A(),v=window.performance.now()),e.next=5,a;case 5:return r=e.sent,a=null,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))()},flush:function(){for(var e=[],r=0,t=Object.values(b);r<t.length;r++){var n=t[r];e.push(n.otClient.flush())}return Promise.all([].concat(e,j).map((function(e){return e.catch((function(){}))}))).then((function(){}))},persist:function(e){var r=x();return e&&e.skipDebounce&&x.flush(),r},getOTVersion:function(e){var r=b[e];if(!r)throw new Error("No file with path ".concat(e," found."));return r.otClient.version}};return B}},25400:function(e,r,t){"use strict";t.d(r,{qC:function(){return u},sQ:function(){return p},vs:function(){return d}});var n=t(79056),o=t(37529),i=t.n(o),a=function(e){return e.length>0&&"number"===typeof e[e.length-1]&&e.pop(),e},c=function(e){if(!Array.isArray(e))throw Error("Op must be an array of components");for(var r=null,t=0;t<e.length;t++){var n=e[t];switch(typeof n){case"object":if(!("number"===typeof n.d&&n.d>0))throw Error("Object components must be deletes of size > 0");break;case"string":if(!(n.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(n>0))throw Error("Skip components must be >0");if("number"===typeof r)throw Error("Adjacent skip components should be combined")}r=n}if("number"===typeof r)throw Error("Op has a trailing skip")},s=function(e){return"number"===typeof e?e:"string"===typeof e?e.length:e.d};function u(e,r){c(e),c(r);for(var t,n=[],o=l(n),i=f(e)[0],u=0;u<r.length;u++){var p=r[u],d=void 0,h=void 0;switch(typeof p){case"number":for(d=p;d>0;)(h=i(d,"d"))&&o(h),"object"!==typeof h&&(d-=s(h));break;case"string":o(p);break;case"object":for(d=p.d;d>0;)switch(typeof(h=i(d,"d"))){case"number":o({d:h}),d-=h;break;case"string":d-=h.length;break;case"object":h&&o(h)}}}for(;t=i(-1);)o(t);return a(n)}function l(e){return function(r){r&&0!==r.d&&(0===e.length?e.push(r):typeof r===typeof e[e.length-1]?"object"===typeof r?e[e.length-1].d+=r.d:e[e.length-1]+=r:e.push(r))}}function f(e){var r=0,t=0;return[function(n,o){if(r===e.length)return-1===n?null:n;var i,a=e[r];return"number"===typeof a?-1===n||a-t<=n?(i=a-t,++r,t=0,i):(t+=n,n):"string"===typeof a?-1===n||"i"===o||a.length-t<=n?(i=a.slice(t),++r,t=0,i):(i=a.slice(t,t+n),t+=n,i):-1===n||"d"===o||a.d-t<=n?(i={d:a.d-t},++r,t=0,i):(t+=n,{d:n})},function(){return e[r]}]}function p(e,r){if(e===r)return[];var t=[],o=function(e){e&&0!==e.d&&(0===t.length?t.push(e):typeof e===typeof t[t.length-1]?"object"===typeof e?t[t.length-1].d+=e.d:t[t.length-1]+=e:t.push(e))};return i()(e,r).forEach((function(e){var r=(0,n.Z)(e,2),t=r[0],a=r[1];switch(t){case i().INSERT:o(a);break;case i().DELETE:o({d:a.length});break;case i().EQUAL:o(a.length)}})),t.length>0&&"number"===typeof t[t.length-1]&&t.pop(),t}function d(e,r,t){if("left"!==t&&"right"!==t)throw Error("side ("+t+") must be 'left' or 'right'");c(e),c(r);for(var o,i=[],u=l(i),p=f(e),d=(0,n.Z)(p,2),h=d[0],v=d[1],m=0;m<r.length;m++){var b=r[m],y=void 0,g=void 0;switch(typeof b){case"number":for(y=b;y>0;)u(g=h(y,"i")),"string"!==typeof g&&(y-=s(g));break;case"string":"left"===t&&"string"===typeof v()&&u(h(-1)),u(b.length);break;case"object":for(y=b.d;y>0;)switch(typeof(g=h(y,"i"))){case"number":y-=g;break;case"string":u(g);break;case"object":y-=g.d}}}for(;o=h(-1);)u(o);return a(i)}},56023:function(e,r,t){"use strict";var n,o,i,a,c,s;t.d(r,{kS:function(){return n},Fl:function(){return o},Tv:function(){return i},Df:function(){return a},kO:function(){return c},KF:function(){return s}}),function(e){e.Create="CREATE",e.Move="MOVE",e.Delete="DELETE",e.Modify="MODIFY"}(n||(n={})),function(e){e.Local="LOCAL",e.Container="CONTAINER"}(o||(o={})),function(e){e.File="FILE",e.Directory="DIRECTORY"}(i||(i={})),function(e){e.NotFound="NOT_FOUND",e.AlreadyExists="ALREADY_EXIST",e.NotDirectory="NOT_DIRECTORY",e.IsDirectory="IS_DIRECTORY"}(a||(a={})),function(e){e.Syncing="SYNCING",e.Clean="CLEAN"}(c||(c={})),function(e){e.Dirty="DIRTY",e.Syncing="SYNCING",e.Clean="CLEAN"}(s||(s={}))},80001:function(e,r,t){"use strict";t.d(r,{Z:function(){return p}});var n=t(30266),o=t(809),i=t.n(o),a=t(7977),c=t.n(a),s=t(50055),u=t(20536),l=t(40354),f=t(83415);function p(e){var r=e.container,t=e.beforeRun,o=(0,l.Z)(),a=null,p=u.A.OFFLINE,d="none",h=!1,v=Math.random();function m(){var e=function(e){p!==e&&(p=e,o.emit(u.z.STATE_CHANGE,p))};e(a?h?u.A.STOPPING:"none"===d?u.A.IDLE:u.A.RUNNING:u.A.OFFLINE)}function b(){return(b=(0,n.Z)(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE){e.next=2;break}throw new Error("Cannot run while state is not IDLE, got state: "+p);case 2:return r=Math.random(),v=r,d="before-run",m(),e.next=8,t();case 8:if(v===r){e.next=10;break}return e.abrupt("return");case 10:if("none"!==d){e.next=12;break}return e.abrupt("return");case 12:if("server"!==d){e.next=14;break}return e.abrupt("return");case 14:if(a){e.next=16;break}throw new Error("State is RUNNING but shellrunner is null?");case 16:d="optimistic",a.send({runMain:{}});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=(0,n.Z)(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p===u.A.IDLE||p===u.A.RUNNING){e.next=2;break}throw new Error("Can only send input when running or idle");case 2:if(a){e.next=4;break}throw new Error("State is not OFFLINE but shellrunner is null?");case 4:a.send({input:r});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.openChannel({name:"shellrunner",service:"shellrun2",skip:function(e){var r,t=e.repl;return!(0,f.w)()||(r=t.language,!(!0===c().usesInterpreter(r)||!1!==c().usesRunProject(r)))}},(function(e){var r=e.channel;if(!e.error){if(!r)throw new Error("Expected error");return a=r,m(),r.onCommand((function(e){if(null!=e.state){var r=e.state===s.api.State.Stopped;h&&r&&(h=!1),r?"server"===d&&(d="none"):d="server",m()}else null!=e.output&&o.emit(u.z.OUTPUT,e.output)})),function(){d="none",h=!1,a=null,m()}}})),{run:function(){return b.apply(this,arguments)},stopRun:function(){if(p!==u.A.RUNNING)throw new Error("stopRun must be called when running but got ".concat(p));if(!a)throw new Error("State is RUNNING but shellrunner is null?");if("before-run"===d)return d="none",void m();d="none",h=!0,m(),a.send({clear:{}})},sendInput:function(e){return y.apply(this,arguments)},resizeTerminal:function(e){if(!a)throw new Error("resizeTerminal must be called when online");a.send({resizeTerm:e})},onOutput:function(e){return o.on(u.z.OUTPUT,e),function(){o.removeListener(u.z.OUTPUT,e)}},onStateChanged:function(e){return o.on(u.z.STATE_CHANGE,e),function(){o.removeListener(u.z.STATE_CHANGE,e)}},getRunState:function(){return p}}}},24243:function(e,r,t){"use strict";var n=t(68216),o=t(25997),i=t(48764).Buffer,a=function(){function e(r,t){if((0,n.Z)(this,e),this.asEncoding={},this.asBuffer=null,t&&"string"===typeof r)this.asEncoding[t]=r;else if(void 0===r||null===r)this.asBuffer=i.alloc(0);else if(r instanceof i)this.asBuffer=r;else if("string"===typeof r)this.asEncoding.utf8=r;else if(r instanceof ArrayBuffer)this.asBuffer=i.from(r);else{if(r instanceof e)return r;r instanceof Uint8Array?this.asBuffer=i.from(r):"object"===typeof r&&"object"===typeof r.asEncoding&&null!==r.asEncoding&&(r.asBuffer instanceof i||null===r.asBuffer)&&(this.asBuffer=r.asBuffer||null,"string"===typeof r.asEncoding.base64&&(this.asEncoding={base64:r.asEncoding.base64}),"string"===typeof r.asEncoding.utf8&&(this.asEncoding={utf8:r.asEncoding.utf8}))}}return(0,o.Z)(e,[{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";if(void 0!==this.asEncoding[e])return this.asEncoding[e];var r=this.toBuffer(),t=r.toString(e);return this.asEncoding[e]=t,t}},{key:"toJSON",value:function(){return{asEncoding:{base64:this.toString("base64")},asBuffer:null}}},{key:"length",get:function(){return void 0!==this.asEncoding.utf8?this.asEncoding.utf8.length:this.toBuffer().length}},{key:"toBuffer",value:function(){if(this.asBuffer)return this.asBuffer;for(var e in this.asEncoding){var r=this.asEncoding[e];if("string"===typeof r){var t=i.from(r,e);return this.asBuffer=t,t}}return this.asBuffer=i.alloc(0),this.asBuffer}}],[{key:"from",value:function(r,t){return new e(r,t)}},{key:"isBuffer",value:function(r){return r instanceof e}}]),e}();r.Z=a},81493:function(e,r,t){"use strict";t.d(r,{Q:function(){return u}});var n=t(92809),o=t(561),i=t(38934);function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var s=new o.R({dsn:"https://7f707426a65447cc94b6fca9a2a4afb9@sentry.replit.com/14",release:"5ed2baf",environment:"production",beforeSend:function(e,r){var t;return r&&(t=r.originalException,Boolean(t&&"object"===typeof t&&"CustomSentryError"===t.name))&&(r.originalException.extras&&(e.extra=c(c({},e.extra),r.originalException.extras)),r.originalException.tags&&(e.tags=c(c({},e.tags),r.originalException.tags))),e}});function u(e,r){if((0,i.track)(i.events.WS_CRASHED),s){var t;try{throw new Error("Sentry syntheticException")}catch(n){t=n}return s.captureException(e,{originalException:e,syntheticException:t},r)}}},74298:function(e,r,t){"use strict";t.d(r,{GA:function(){return o},yr:function(){return i},pC:function(){return a},vk:function(){return c},hk:function(){return s}});function n(e){return""===e||e.endsWith("/")?e:e+"/"}function o(e,r){return Object.keys(e).filter((function(e){return i(r,e)}))}function i(e,r){return r!==e&&r.startsWith(n(e))}function a(e,r){if(!i(e,r))return!1;var t=n(e),o=r.slice(t.length);return o.endsWith("/")&&(o=o.slice(-1)),!o.includes("/")}function c(e,r,t){var n=o(e,r).map((function(e){return[e,s(r,t,e)]}));return"undefined"!==typeof e[r]&&n.unshift([r,t]),n}function s(e,r,t){var o=n(e);return n(r)+t.slice(o.length)}},39963:function(e,r,t){"use strict";t.d(r,{Rh:function(){return b},Zr:function(){return y},lD:function(){return g}});var n=t(79056),o=t(65988),i=t(67294),a=t(83587),c=t(88834),s=t(10277),u=t(95211),l=t(53567),f=t(82672),p=t(20536),d=t(35944);function h(e,r){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"===typeof e)return v(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return v(e,r)}(e))||r&&e&&"number"===typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(c)throw i}}}}function v(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var m=function(e,r){var t=e.runner,c=e.packager,s=e.languageHeader,u=e.onClear,v=e.enableScreenReaderMode,m=function(e){var r=e.runner,t=e.packager,o=e.languageHeader,a=e.enableScreenReaderMode,c=(0,f.Z)({createXtermProps:{enableScreenReaderMode:a}}),s=(0,n.Z)(c,2),u=s[0],l=s[1],d=i.useState(""),v=(0,n.Z)(d,2),m=v[0],b=v[1];return i.useEffect((function(){if(!u)return r.onOutput((function(e){return b((function(r){return r+e}))}))}),[u,r,b]),i.useEffect((function(){if(!u&&t)return t.onOutput((function(e){return b((function(r){return r+e.replace(/\n/g,"\n\r")}))}))}),[u,t,b]),i.useEffect((function(){if(u&&t)return t.onOutput((function(e){return u.write(e.replace(/\n/g,"\n\r"))}))}),[u,t]),i.useEffect((function(){m&&u&&(u.write(m),b(""))}),[u,m]),i.useEffect((function(){o&&b((function(e){return e+"".concat(o.replace(/\n/g,"\n\r"),"\n\r")}))}),[o,b]),i.useEffect((function(){if(u){var e=function(){r.getRunState()!==p.A.OFFLINE&&r.resizeTerminal(u.getSize())},t=[];t.push(u.onResize(e).dispose);var n=[];t.push(u.onData((function(e){r.getRunState()!==p.A.OFFLINE?r.sendInput(e):n.push(e)})).dispose),t.push(r.onOutput((function(e){u.write(e)})));var o=!1;return t.push(r.onStateChanged((function(t){if(t!==p.A.OFFLINE){if(o||(e(),o=!0),n.length){var i,a=h(n);try{for(a.s();!(i=a.n()).done;){var c=i.value;r.sendInput(c)}}catch(s){a.e(s)}finally{a.f()}n=[]}}else o=!1}))),r.getRunState()!==p.A.OFFLINE&&(e(),o=!0),function(){t.forEach((function(e){return e()}))}}}),[u,r]),[u,l]}({runner:t,packager:c,languageHeader:s,enableScreenReaderMode:v}),w=(0,n.Z)(m,2),k=w[0],x=w[1],C=i.useState(!1),E=(0,n.Z)(C,2),O=E[0],S=E[1];return i.useImperativeHandle(r,(function(){return{clear:function(){k&&k.clear()}}})),(0,d.BX)("div",{onKeyDown:function(e){"f"===e.key&&(0,a.jh)(e)&&!e.shiftKey&&(S(!0),e.preventDefault())},className:"jsx-1467601921 replit-ui-theme-root dark terminal",children:[(0,d.tZ)("div",{className:"jsx-1467601921 controls",children:(0,d.BX)(l.Ug,{align:"center",wrap:"nowrap",children:[O&&k?(0,d.tZ)(b,{findPrevious:k.findPrevious,findNext:k.findNext,exit:function(){return S(!1)}}):(0,d.tZ)(g,{onClick:function(){return S(!0)}}),(0,d.tZ)(y,{onClick:function(){k&&(k.clear(),u&&u(),s&&k.write("".concat(s.replace(/\n/g,"\n\r"),"\n\r")),k.focus())}})]})}),(0,d.tZ)("div",{ref:x,className:"jsx-1467601921 xterm-container"}),(0,d.tZ)(o.default,{id:"1467601921",children:[".terminal.jsx-1467601921{height:100%;width:100%;position:relative;background-color:var(--background-default);border-radius:var(--border-radius-4);padding-left:var(--space-16);padding-top:var(--space-4);}",".controls.jsx-1467601921{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;position:absolute;top:var(--space-8);right:var(--space-8);z-index:100;min-height:30px;}",".xterm-container.jsx-1467601921{height:100%;overflow:auto;}",".xterm-container.jsx-1467601921 .xterm{height:100%;}",".xterm-container.jsx-1467601921 .xterm-viewport{overflow-y:auto !important;border-radius:var(--border-radius-4);}"]})]})};function b(e){var r=e.findNext,t=e.findPrevious,a=e.exit,s=i.useRef(null),u=i.useState(""),l=(0,n.Z)(u,2),f=l[0],p=l[1];i.useEffect((function(){s.current&&s.current.focus()}),[]);return(0,d.BX)("div",{className:"jsx-2719349621 search",children:[(0,d.tZ)("input",{ref:s,placeholder:"Find",value:f,onChange:function(e){return p(e.target.value)},onKeyDown:function(e){return function(e){"Escape"!==e.key?"Enter"===e.key&&(e.shiftKey?t(f):r(f)):a()}(e)},className:"jsx-2719349621"}),(0,d.tZ)(c.Z,{size:"small",onClick:function(){return r(f)},children:"Next"}),(0,d.tZ)(c.Z,{size:"small",onClick:function(){return t(f)},children:"Previous"}),(0,d.tZ)(c.Z,{size:"small",onClick:a,children:"Exit"}),(0,d.tZ)(o.default,{id:"2719349621",children:[".search.jsx-2719349621{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:30px;}","input.jsx-2719349621{padding:4px var(--space-8) var(--space-4);background-color:var(--background-default);color:var(--white);height:24px;width:85px;border:none;border-radius:var(--border-radius-4);box-shadow:none;}","input.jsx-2719349621::-webkit-input-placeholder{color:var(--white);}","input.jsx-2719349621::-moz-placeholder{color:var(--white);}","input.jsx-2719349621:-ms-input-placeholder{color:var(--white);}","input.jsx-2719349621::placeholder{color:var(--white);}","input.jsx-2719349621:focus{outline:none;border:var(--accent-primary-default);}","input.jsx-2719349621,.search button{margin:0 var(--space-4);}"]})]})}r.ZP=i.forwardRef(m);var y=function(e){var r=e.onClick;return(0,d.BX)("button",{"aria-label":"Clear","data-microtip-position":"bottom-left",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,d.tZ)(u.Z,{size:16}),(0,d.tZ)(o.default,{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})},g=function(e){var r=e.onClick;return(0,d.BX)("button",{"aria-label":"Search","data-microtip-position":"bottom",role:"tooltip",onClick:r,className:"jsx-259645926",children:[(0,d.tZ)(s.Z,{size:16}),(0,d.tZ)(o.default,{id:"259645926",children:["button.jsx-259645926{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:var(--border-radius-4);padding:var(--space-4);background-color:var(--background-root);color:var(--foreground-default);-webkit-transition:background-color 0.2s;transition:background-color 0.2s;border:none;cursor:pointer;}","button.jsx-259645926:hover{background-color:var(--background-higher);}","button.jsx-259645926:focus{outline:none;}"]})]})}},19989:function(e){e.exports={isHiddenFile:function(e){return/^(\.env$|\.npm$|\.npm\/|__pycache__|\.cache|\.git$|\.git\/|\.upm$|\.upm\/|node_modules$|node_modules\/|_test_runner)/.test(e)},ignoredDirs:[".git",".upm",".cache","__pycache__","node_modules"]}}}]);
//# sourceMappingURL=5326-4f8c2857232d27671d4f.js.map